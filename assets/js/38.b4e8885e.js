(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{396:function(a,s,t){"use strict";t.r(s);var r=t(15),e=Object(r.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("p",[a._v("当我们执行 java -jar xxx.jar的时候，JVM开始工作了，类加载子系统在初始化阶段开始工作，类加载经过哪些步骤？如何校验字节码是否正确？什么是双亲委派？双亲委派的作用是什么？Tomcat为什么要打破双亲委派？如何打破双亲委派？")]),a._v(" "),s("h2",{attrs:{id:"类加载器分类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#类加载器分类"}},[a._v("#")]),a._v(" 类加载器分类")]),a._v(" "),s("h3",{attrs:{id:"启动类加载器-bootstrapclassloader"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动类加载器-bootstrapclassloader"}},[a._v("#")]),a._v(" 启动类加载器 BootstrapClassLoader")]),a._v(" "),s("p",[a._v("负责加载核心包 如 rt.jar ,charsets.jar , 目录位于 JRE的lib下")]),a._v(" "),s("h3",{attrs:{id:"扩展类加载器-extclassloader"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#扩展类加载器-extclassloader"}},[a._v("#")]),a._v(" 扩展类加载器 ExtClassloader")]),a._v(" "),s("p",[a._v("负责加载JRE的扩展库，目录位于JRE的lib/ext 。")]),a._v(" "),s("h3",{attrs:{id:"应用类加载器-appclassloader"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#应用类加载器-appclassloader"}},[a._v("#")]),a._v(" 应用类加载器 AppClassloader")]),a._v(" "),s("p",[a._v("负责加载classpath下的类库， 可指定加载jar ，加参数 --classpath , --cp")]),a._v(" "),s("h3",{attrs:{id:"自定义类加载-customxxxclassloader"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自定义类加载-customxxxclassloader"}},[a._v("#")]),a._v(" 自定义类加载 CustomXxxClassloader")]),a._v(" "),s("h2",{attrs:{id:"类加载过程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#类加载过程"}},[a._v("#")]),a._v(" 类加载过程")]),a._v(" "),s("h3",{attrs:{id:"加载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#加载"}},[a._v("#")]),a._v(" 加载")]),a._v(" "),s("p",[a._v("将字节码文件从硬盘读取到内存的过程，这个过程是按需加载，只有被使用到的类才会加载， "),s("code",[a._v("new")]),a._v(" 一个对象 , "),s("code",[a._v('class.forName("xxx.class")')]),a._v(" 等会触发加载 。")]),a._v(" "),s("p",[a._v("注意 ： "),s("code",[a._v("Math math = null")]),a._v(" 这种不会被加载")]),a._v(" "),s("h3",{attrs:{id:"校验"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#校验"}},[a._v("#")]),a._v(" 校验")]),a._v(" "),s("p",[a._v("验证字节码文件格式是否正确")]),a._v(" "),s("h3",{attrs:{id:"准备"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#准备"}},[a._v("#")]),a._v(" 准备")]),a._v(" "),s("p",[a._v("给静态变量分配内存，并赋默认值。")]),a._v(" "),s("h3",{attrs:{id:"解析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解析"}},[a._v("#")]),a._v(" 解析")]),a._v(" "),s("p",[a._v("将符号引用替换为直接因为， "),s("strong",[a._v("静态链接过程")])]),a._v(" "),s("h3",{attrs:{id:"初始化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#初始化"}},[a._v("#")]),a._v(" 初始化")]),a._v(" "),s("ol",[s("li",[a._v("给静态变量赋值")]),a._v(" "),s("li",[a._v("执行静态代码块")])]),a._v(" "),s("blockquote",[s("p",[a._v("静态变量与静态代码块不区分优先级，按代码顺序执行")])]),a._v(" "),s("h2",{attrs:{id:"双亲委派机制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#双亲委派机制"}},[a._v("#")]),a._v(" 双亲委派机制")]),a._v(" "),s("h3",{attrs:{id:"双亲委派机制的过程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#双亲委派机制的过程"}},[a._v("#")]),a._v(" 双亲委派机制的过程")]),a._v(" "),s("ol",[s("li",[a._v("委托父类加载器加载")]),a._v(" "),s("li",[a._v("父类加载器找不到再自己去加载")])]),a._v(" "),s("blockquote",[s("p",[a._v("表现为向上委托，向下加载的过程")])]),a._v(" "),s("h3",{attrs:{id:"为什么需要双亲委派机制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为什么需要双亲委派机制"}},[a._v("#")]),a._v(" 为什么需要双亲委派机制？")]),a._v(" "),s("ol",[s("li",[a._v("避免重复加载")]),a._v(" "),s("li",[a._v("防止核心类被篡改")])]),a._v(" "),s("h3",{attrs:{id:"tomcat打破双亲委派机制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tomcat打破双亲委派机制"}},[a._v("#")]),a._v(" Tomcat打破双亲委派机制")]),a._v(" "),s("p",[a._v("一个Tomcat实例支持多个应用")]),a._v(" "),s("div",{staticClass:"language-text line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("tomcat\n  -- webapp1  依赖spring 3 \n  -- webapp2  依赖spring 4\n  -- webapp3  依赖spring 5 \n\n我们看到每个应用可能依赖不同的spring，如果使用双亲委派会导致版本问题，所以Tomcat必须打破双亲委派\n  \n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("h3",{attrs:{id:"如何打破双亲委派机制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如何打破双亲委派机制"}},[a._v("#")]),a._v(" 如何打破双亲委派机制？")]),a._v(" "),s("p",[a._v("自己写一个类去继承 "),s("code",[a._v("ClassLoader")]),a._v(" , 并且重写 "),s("code",[a._v("loadClass")]),a._v(" 和 "),s("code",[a._v("findClass")]),a._v(" 两个方法。")])])}),[],!1,null,null,null);s.default=e.exports}}]);