---
title: synchronized
date: 2022-05-10 16:53:46
permalink: /pages/9d7b0a/
categories:
  - 并发编程
tags:
  - 
author: 
  name: weiluoliang
  link: https://github.com/weiluoliang
---





## 对象头

## MarkWord

![image-20220511110318558](https://cdn.jsdelivr.net/gh/weiluoliang/img@main/blog/image-20220511110318558.webp)



64位的markword

![](https://cdn.jsdelivr.net/gh/weiluoliang/img@main/blog/Markword-64.webp)



## ObjectMonitor





## 偏向锁

jvm参数-XX:+UseBiasedLocking  ，默认开启 



## 轻量级锁





## 重量级锁

### 锁膨胀过程

synchronizer.cpp  ：

​      `ObjectMonitor * ATTR ObjectSynchronizer::inflate (Thread * Self, oop object)`

1. 如果已经有Monitor对象，直接返回
2. 如果其他线程正在膨胀这个锁，`mark == markOopDesc::INFLATING()`.  自旋等待膨胀完成
3. 如果当前是轻量级锁，尝试升级为重量级锁 。
4. 若当前为无锁  ，





## 参考资料

[https://dunwu.github.io/javacore/pages/560949](https://dunwu.github.io/javacore/pages/560949)

[掘金，有一首歌叫瓜牛，synchronized深度解析 -- 引言](https://juejin.cn/post/6860322821865340935)

[openjdk： markWord源码（markOop.hpp）](http://hg.openjdk.java.net/jdk8u/jdk8u/hotspot/file/d2c2cd90513e/src/share/vm/oops/markOop.hpp)

