---
title: 线程池
date: 2022-08-04 10:26:56
permalink: /pages/d936e6/
categories:
  - 基础原理知识
tags:
  - 
author: 
  name: weiluoliang
  link: https://github.com/weiluoliang
---





问： 线程池shutdown与shutdownNow的区别？ 



使用线程池注意：

1. 指定容量
2. 不使用FixedThreadPool() 没有指定容量，可能发生OOM



## 源码解析

ThreadPoolExecutor类 

- execute() 



- addWorker()

​     创建线程和任务 

​     为什么需要双重循环？  

​     

参数 ctl :  表示线程池状态 （高3位）和  线程数（低）

 



Worker类



## 扩展点

beforeExecute()  

afterExecute()

terminated()



### 如何预估线程池的大小 ？ 

1.  IO密集型还是CPU密集型？
   1. cpu密集型 ：减少上下文切换    N+1  
   2. IO密集型 ：  核心线程数 = 2N + 1  

动态调整 ：  
