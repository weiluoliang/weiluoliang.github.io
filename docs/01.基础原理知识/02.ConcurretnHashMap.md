---
title: ConcurretnHashMap
date: 2022-07-14 15:09:18
permalink: /pages/31d423/
categories:
  - 基础原理知识
tags:
  - 
author: 
  name: weiluoliang
  link: https://github.com/weiluoliang
---





## 面试题

1、如何找到大于一个数的最小2的幂？比如大于5的最小2的幂就是8，大于7的最小2的幂也是8，大于9的最小
2的幂是16，请列举2种方法。

2、简述ConcurrentHashMap中hash扰动的原理，为什么要扰动？

3、hashmap的hash扰动为什么比ConcurrentHashMap少了一个 “&HASH_BITS”？

4、ConcurrentHashMap中sizeCtl字段的含义，下面哪个说法是错误的？  
1）、默认为0，用来控制table的初始化和扩容操作
2）、-1 代表table正在初始化
3）、-N 表示有N-1个线程正在进行扩容操作
4）、如果table未初始化，表示table需要初始化的大小。
5）、如果table初始化完成，表示table的容量，默认是table大小的0.75倍

5、ConcurrentHashMap在初始化的时候是如何控制多线程安全性的？

6、ConcurrentHashmap容量为什么要设置成2的幂次方？

7、ConcurrentHashMap在扩容的时候sizeCtl是一个非-1的负值，如何得来的？

码炫课堂 版权所有8、ConcurrentHashmap的红黑树的binCount未什么固定为2？

9、ConcurrentHashmap最多允许多少线程同时参与扩容？

10、ConcurrentHashmap扩容前计数在高并发时为什么效率很高？

11、ConcurrentHashmap每个线程都会参与扩容吗？如果不是，那么参与扩容的线程的条件是什么？

12、ConcurrentHashmap参与扩容的线程至少负责多少个哈希桶的迁移？

13、ConcurrentHashmap多线程下分配迁移任务是如何保证安全性分配的？

14、ConcurrentHashmap迁移时普通链表是如何迁移的？

15、ConcurrentHashmap迁移时红黑树是如何迁移的？

16、ConcurrentHashmap链表转树的时候为什么要同时维护一个双向链表？

17、ConcurrentHashmap某个哈希桶迁移之后分离为高桶和低桶，请问高桶和低桶之间的间距为什么是原来
table的长度？

18、话说假如有32个线程并发，ConcurrentHashMap的执行效率大概是hashtable的几倍？

19、ConcurrentHashmap某个哈希桶迁移之后分离为高桶和低桶，有没有可能所有节点都在高桶位置或者都
在低桶位置？

20、ConcurrentHashMap在查询的时候有没有并发问题？如果有，具体是什么问题？

21、ConcurrentHashMap在迁移的时候，如果读线程正在执行get操作，此时有什么影响？

22、ConcurrentHashMap的红黑树在新增后调整平衡的时候，get操作能查吗？为什么？

23、通常读写锁都有写-写竞争，读-写竞争，读-读不竞争这3个特性，那么ConcurrentHashMap的寄生读
写锁不具备哪个特性？为什么？

24、ConcurrentHashMap的TreeBin节点为什么还要维护一个寄生读写锁？
25、ConcurrentHashMap中的寄生读写锁，当读线程发现有线程在等待时为什么走链表查找而不走红黑树查
找？

26、ConcurrentHashMap扩容迁移之后，原map上的节点最后都被垃圾回收了吗？如果不是，那么哪些没有
被回收？

27、ConcurrentHashMap红黑树迁移后，树居然消失了，在什么情况下会消失？？

28、ConcurrentHashMap在迁移时lastRun指针所起的作用是什么？

29、ConcurrentHashMap红黑树新增节点时对应到双向链表上是头插还是尾插？

30、红黑树上删除节点时为什么ConcurrentHashMap不采用treeMap的替换值的方式而是采用替换节点的方
式？
31、ConcurrentHashmap某个哈希桶迁移时如何确定其在新map中的位置？

32、ConcurrentHashmap红黑树迁移时反树化的条件是什么？

33、ConcurrentHashmap迁移时假如哈希桶上是链表，那么构造高低桶链表时采用头插还是尾插？

34、ConcurrentHashmap迁移时假如哈希桶上是红黑树，那么构造高低桶链表时采用头插还是尾插？

35、jdk8的ConcurrentHashmap里有哪些bug？

36、spring三级缓存中是如何使用ConcurrentHashMap的？
